<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System with Pomodoro Timer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background: #000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
        }
        
        /* ============== Panel Base Styles ============== */
        .control-panel {
            position: fixed;
            background: rgba(20, 25, 40, 0.9);
            padding: 20px;
            border-radius: 12px;
            color: #e0e8ff;
            z-index: 100;
            min-width: 260px;
            border: 1px solid rgba(100, 120, 180, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        
        /* Position Classes */
        .pos-top-left { top: 20px; left: 20px; }
        .pos-top-right { top: 20px; right: 20px; }
        .pos-bottom-left { bottom: 20px; left: 20px; }
        .pos-bottom-right { bottom: 20px; right: 20px; }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(100, 120, 180, 0.3);
        }
        .panel-header h3 {
            font-size: 16px;
            color: #a0c0ff;
            margin: 0;
        }
        .position-select {
            padding: 4px 8px;
            border: 1px solid rgba(100, 120, 180, 0.4);
            border-radius: 4px;
            background: rgba(30, 40, 60, 0.8);
            color: #c0d0ff;
            font-size: 11px;
            cursor: pointer;
        }
        .position-select:focus {
            outline: none;
            border-color: #4080c0;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: block;
            font-size: 12px;
            color: #8090b0;
            margin-bottom: 5px;
        }
        .control-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }
        .control-row input[type="number"] {
            width: 80px;
            padding: 6px 8px;
            border: 1px solid rgba(100, 120, 180, 0.4);
            border-radius: 4px;
            background: rgba(30, 40, 60, 0.8);
            color: #c0d0ff;
            font-size: 13px;
            font-weight: bold;
        }
        .control-row input[type="number"]:focus {
            outline: none;
            border-color: #4080c0;
        }
        .step-label {
            font-size: 11px;
            color: #8090b0;
        }
        .step-input {
            width: 60px !important;
        }
        .btn-row {
            display: flex;
            gap: 6px;
        }
        button {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3060a0, #4080c0);
            color: white;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #4080c0, #50a0e0);
        }
        .btn-secondary {
            background: rgba(60, 80, 120, 0.5);
            color: #c0d0ff;
        }
        .btn-secondary:hover {
            background: rgba(80, 100, 150, 0.6);
        }
        .btn-pause {
            background: linear-gradient(135deg, #a06030, #c08040);
            color: white;
        }
        .btn-pause.paused {
            background: linear-gradient(135deg, #30a060, #40c080);
        }
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 0;
        }
        .toggle-row span {
            font-size: 13px;
        }
        .toggle {
            width: 40px;
            height: 22px;
            background: rgba(60, 80, 120, 0.5);
            border-radius: 11px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle.active {
            background: linear-gradient(135deg, #3080c0, #40a0e0);
        }
        .toggle::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }
        .toggle.active::after {
            left: 20px;
        }
        
        /* Remove spinner arrows from number inputs */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* ============== Pomodoro Panel Styles ============== */
        #pomodoro-panel {
            min-width: 280px;
        }
        
        .timer-display {
            text-align: center;
            margin: 20px 0;
        }
        .timer-time {
            font-size: 48px;
            font-weight: bold;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(100, 150, 255, 0.5);
        }
        .timer-status {
            font-size: 14px;
            color: #a0c0ff;
            margin-top: 8px;
        }
        .timer-status.focusing {
            color: #ff8080;
        }
        .timer-status.resting {
            color: #80ff80;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(60, 80, 120, 0.5);
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4080c0, #60a0e0);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .progress-fill.focusing {
            background: linear-gradient(90deg, #c04040, #e06060);
        }
        .progress-fill.resting {
            background: linear-gradient(90deg, #40c040, #60e060);
        }
        
        .pomodoro-count {
            text-align: center;
            font-size: 24px;
            margin: 15px 0;
            color: #ff6b6b;
        }
        .pomodoro-count span {
            color: #c0d0ff;
            font-size: 16px;
            margin-left: 5px;
        }
        
        .time-settings {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .time-setting {
            text-align: center;
        }
        .time-setting label {
            display: block;
            font-size: 10px;
            color: #8090b0;
            margin-bottom: 4px;
        }
        .time-setting input {
            width: 100%;
            padding: 6px;
            border: 1px solid rgba(100, 120, 180, 0.4);
            border-radius: 4px;
            background: rgba(30, 40, 60, 0.8);
            color: #c0d0ff;
            font-size: 14px;
            text-align: center;
        }
        
        .pomodoro-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .btn-start {
            background: linear-gradient(135deg, #30a060, #40c080);
        }
        .btn-start:hover {
            background: linear-gradient(135deg, #40c080, #50e0a0);
        }
        .btn-start.running {
            background: linear-gradient(135deg, #a06030, #c08040);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #a03030, #c04040);
            color: white;
        }
        .btn-danger:hover {
            background: linear-gradient(135deg, #c04040, #e05050);
        }
        
        .btn-small {
            padding: 6px 10px;
            font-size: 11px;
        }
        
        /* ============== Modal Styles ============== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        .modal-overlay.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: rgba(25, 30, 50, 0.95);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid rgba(100, 120, 180, 0.4);
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-title {
            font-size: 24px;
            color: #ffffff;
            margin-bottom: 15px;
        }
        .modal-message {
            font-size: 16px;
            color: #a0b0d0;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .modal-buttons button {
            padding: 12px 20px;
            font-size: 14px;
        }
        
        /* ============== Info Panel ============== */
        #info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(20, 25, 40, 0.75);
            padding: 12px 16px;
            border-radius: 8px;
            color: #8090b0;
            font-size: 11px;
            max-width: 300px;
            line-height: 1.5;
            z-index: 50;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <!-- Solar System Control Panel -->
    <div id="solar-panel" class="control-panel pos-top-left">
        <div class="panel-header">
            <h3>üåå Solar System</h3>
            <select class="position-select" id="solarPanelPosition" onchange="changePanelPosition('solar-panel', this.value)">
                <option value="top-left">‚Üñ Top-Left</option>
                <option value="top-right">‚Üó Top-Right</option>
                <option value="bottom-left">‚Üô Bottom-Left</option>
                <option value="bottom-right">‚Üò Bottom-Right</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>Time Scale (days/sec)</label>
            <div class="control-row">
                <input type="number" id="timeScaleInput" value="50" min="1" max="100000" onchange="setTimeScale(this.value)">
                <span class="step-label">Step:</span>
                <input type="number" id="timeStepInput" class="step-input" value="10" min="1" onchange="updateTimeStep(this.value)">
            </div>
            <div class="btn-row">
                <button class="btn-primary" onclick="changeTimeScale(-1)">‚àí</button>
                <button class="btn-primary" onclick="changeTimeScale(1)">+</button>
            </div>
        </div>
        
        <div class="control-group">
            <label>Zoom Level</label>
            <div class="control-row">
                <input type="number" id="zoomInput" value="1.00" min="0.1" max="50" step="0.1" onchange="setZoom(this.value)">
                <span class="step-label">Step:</span>
                <input type="number" id="zoomStepInput" class="step-input" value="0.5" min="0.1" step="0.1" onchange="updateZoomStep(this.value)">
            </div>
            <div class="btn-row">
                <button class="btn-primary" onclick="changeZoom(-1)">‚àí</button>
                <button class="btn-primary" onclick="changeZoom(1)">+</button>
                <button class="btn-secondary" onclick="resetView()">Reset</button>
            </div>
        </div>
        
        <div class="control-group">
            <button class="btn-pause" id="pauseBtn" onclick="togglePause()">‚è∏ Pause</button>
        </div>
        
        <div class="control-group">
            <div class="toggle-row">
                <span>Show Labels</span>
                <div class="toggle active" id="toggleLabels" onclick="toggleLabels()"></div>
            </div>
            <div class="toggle-row">
                <span>Show Orbits</span>
                <div class="toggle active" id="toggleOrbits" onclick="toggleOrbits()"></div>
            </div>
        </div>
    </div>
    
    <!-- Pomodoro Timer Panel -->
    <div id="pomodoro-panel" class="control-panel pos-bottom-left">
        <div class="panel-header">
            <h3>üçÖ Pomodoro</h3>
            <select class="position-select" id="pomodoroPanelPosition" onchange="changePanelPosition('pomodoro-panel', this.value)">
                <option value="top-left">‚Üñ Top-Left</option>
                <option value="top-right">‚Üó Top-Right</option>
                <option value="bottom-left" selected>‚Üô Bottom-Left</option>
                <option value="bottom-right">‚Üò Bottom-Right</option>
            </select>
        </div>
        
        <div class="timer-display">
            <div class="timer-time" id="timerDisplay">25:00</div>
            <div class="timer-status" id="timerStatus">Ready to focus</div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 100%"></div>
        </div>
        
        <div class="pomodoro-count">
            üçÖ <span id="pomodoroCount">√ó 0</span>
        </div>
        
        <div class="time-settings">
            <div class="time-setting">
                <label>Focus (min)</label>
                <input type="number" id="focusTime" value="25" min="1" max="120" onchange="updatePomodoroSettings()">
            </div>
            <div class="time-setting">
                <label>Short Break</label>
                <input type="number" id="shortBreakTime" value="5" min="1" max="30" onchange="updatePomodoroSettings()">
            </div>
            <div class="time-setting">
                <label>Long Break</label>
                <input type="number" id="longBreakTime" value="15" min="1" max="60" onchange="updatePomodoroSettings()">
            </div>
        </div>
        
        <div class="pomodoro-buttons">
            <button class="btn-start" id="pomodoroStartBtn" onclick="togglePomodoro()">‚ñ∂ Start</button>
            <button class="btn-secondary" onclick="skipPomodoro()">‚è≠ Skip</button>
            <button class="btn-danger btn-small" onclick="resetPomodoro()">‚Ü∫</button>
        </div>
        
        <div class="btn-row">
            <button class="btn-secondary btn-small" onclick="resetPomodoroCount()">Reset Count</button>
        </div>
    </div>
    
    <!-- Modal for Pomodoro notifications -->
    <div class="modal-overlay" id="pomodoroModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">üéâ Pomodoro Complete!</div>
            <div class="modal-message" id="modalMessage">Great job! You've completed a pomodoro.</div>
            <div class="modal-buttons" id="modalButtons">
                <!-- Buttons will be dynamically inserted -->
            </div>
        </div>
    </div>
    
    <!-- Info Panel -->
    <div id="info">
        <strong>Navigation:</strong> Mouse wheel to zoom. Orbits are true ellipses with Sun at focus.
    </div>

    <script>
    // ============================================================
    // DATA SECTION - Planetary data table
    // ============================================================
    
    const AU_KM = 149597870.7;
    
    const SUN_DATA = {
        name: "Sun",
        radiusKm: 696340,
        color: "#FFF5E0"
    };
    
    const PLANETS_DATA = [
        { name: "Mercury", radiusKm: 2439.7, a_AU: 0.387098, e: 0.205630, periodDays: 87.969, color: "#B5A7A7" },
        { name: "Venus", radiusKm: 6051.8, a_AU: 0.723332, e: 0.006772, periodDays: 224.701, color: "#E6C87A" },
        { name: "Earth", radiusKm: 6371.0, a_AU: 1.000000, e: 0.0167086, periodDays: 365.256, color: "#6B93D6" },
        { name: "Mars", radiusKm: 3389.5, a_AU: 1.523679, e: 0.093400, periodDays: 686.980, color: "#C1440E" },
        { name: "Jupiter", radiusKm: 69911.0, a_AU: 5.2044, e: 0.048900, periodDays: 4332.59, color: "#D8CA9D" },
        { name: "Saturn", radiusKm: 58232.0, a_AU: 9.5826, e: 0.056500, periodDays: 10759.22, color: "#F4D59E" },
        { name: "Uranus", radiusKm: 25362.0, a_AU: 19.2184, e: 0.047200, periodDays: 30688.5, color: "#D1E7E7" },
        { name: "Neptune", radiusKm: 24622.0, a_AU: 30.1104, e: 0.008600, periodDays: 60182.0, color: "#5B5DDF" }
    ];
    
    // ============================================================
    // CONFIGURATION
    // ============================================================
    
    const BASE_SCALE_PX_PER_AU = 12;
    const MIN_VISIBLE_PLANET_RADIUS_PX = 2.5;
    const VENUS_A_AU = 0.723332;
    const SUN_VISUAL_RADIUS_AU = VENUS_A_AU / 5 / 3;
    const MIN_SUN_RADIUS_PX = 4;
    
    let timeScale = 50;
    let timeStep = 10;
    const MIN_TIME_SCALE = 1;
    const MAX_TIME_SCALE = 100000;
    
    let zoom = 1.0;
    let zoomStep = 0.5;
    const MIN_ZOOM = 0.1;
    const MAX_ZOOM = 50;
    
    let simulationTimeDays = 0;
    let isPaused = false;
    let lastFrameTime = 0;
    let showLabels = true;
    let showOrbits = true;
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let stars = [];
    
    // Panel positions
    let panelPositions = {
        'solar-panel': 'top-left',
        'pomodoro-panel': 'bottom-left'
    };
    
    // ============================================================
    // POMODORO STATE
    // ============================================================
    
    let pomodoroState = {
        isRunning: false,
        mode: 'focus', // 'focus', 'shortBreak', 'longBreak'
        timeRemaining: 25 * 60, // seconds
        totalTime: 25 * 60,
        completedPomodoros: 0,
        settings: {
            focusTime: 25,
            shortBreakTime: 5,
            longBreakTime: 15
        }
    };
    
    let pomodoroInterval = null;
    let audioContext = null;
    
    // ============================================================
    // PANEL POSITION MANAGEMENT
    // ============================================================
    
    function changePanelPosition(panelId, newPosition) {
        const otherPanelId = panelId === 'solar-panel' ? 'pomodoro-panel' : 'solar-panel';
        const otherPosition = panelPositions[otherPanelId];
        
        // If trying to move to occupied position, swap panels
        if (newPosition === otherPosition) {
            const oldPosition = panelPositions[panelId];
            panelPositions[otherPanelId] = oldPosition;
            updatePanelPositionClass(otherPanelId, oldPosition);
            document.getElementById(otherPanelId === 'solar-panel' ? 'solarPanelPosition' : 'pomodoroPanelPosition').value = oldPosition;
        }
        
        panelPositions[panelId] = newPosition;
        updatePanelPositionClass(panelId, newPosition);
        
        // Save to localStorage
        localStorage.setItem('panelPositions', JSON.stringify(panelPositions));
    }
    
    function updatePanelPositionClass(panelId, position) {
        const panel = document.getElementById(panelId);
        panel.className = 'control-panel pos-' + position;
    }
    
    function loadPanelPositions() {
        const saved = localStorage.getItem('panelPositions');
        if (saved) {
            panelPositions = JSON.parse(saved);
            for (const [panelId, position] of Object.entries(panelPositions)) {
                updatePanelPositionClass(panelId, position);
                const selectId = panelId === 'solar-panel' ? 'solarPanelPosition' : 'pomodoroPanelPosition';
                document.getElementById(selectId).value = position;
            }
        }
    }
    
    // ============================================================
    // PHYSICS - Kepler equation solver
    // ============================================================
    
    function solveKeplerEquation(M, e) {
        M = M % (2 * Math.PI);
        if (M > Math.PI) M -= 2 * Math.PI;
        if (M < -Math.PI) M += 2 * Math.PI;
        
        let E = M;
        const maxIterations = 50;
        const tolerance = 1e-14;
        
        for (let i = 0; i < maxIterations; i++) {
            const sinE = Math.sin(E);
            const cosE = Math.cos(E);
            const f = E - e * sinE - M;
            const fPrime = 1 - e * cosE;
            if (Math.abs(fPrime) < 1e-10) break;
            const delta = f / fPrime;
            E -= delta;
            if (Math.abs(delta) < tolerance) break;
        }
        return E;
    }
    
    function calculatePlanetPosition(planet, tDays) {
        const { a_AU, e, periodDays } = planet;
        const n = (2 * Math.PI) / periodDays;
        const M = n * tDays;
        const E = solveKeplerEquation(M, e);
        
        const cosE = Math.cos(E);
        const sinE = Math.sin(E);
        const b_over_a = Math.sqrt(1 - e * e);
        
        const x = a_AU * (cosE - e);
        const y = a_AU * b_over_a * sinE;
        
        return { x, y };
    }
    
    // ============================================================
    // RENDER SECTION
    // ============================================================
    
    function generateStars() {
        stars = [];
        for (let i = 0; i < 300; i++) {
            stars.push({
                x: Math.random(),
                y: Math.random(),
                brightness: 0.3 + Math.random() * 0.7,
                size: 0.5 + Math.random() * 1.5
            });
        }
    }
    
    function drawBackground() {
        const gradient = ctx.createRadialGradient(
            canvas.width / 2, canvas.height / 2, 0,
            canvas.width / 2, canvas.height / 2, Math.max(canvas.width, canvas.height)
        );
        gradient.addColorStop(0, '#0a0a15');
        gradient.addColorStop(0.5, '#050510');
        gradient.addColorStop(1, '#000005');
        
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        for (const star of stars) {
            ctx.beginPath();
            ctx.arc(star.x * canvas.width, star.y * canvas.height, star.size, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
            ctx.fill();
        }
    }
    
    function drawSun(centerX, centerY, scalePxPerAU) {
        let sunVisualRadius = Math.max(SUN_VISUAL_RADIUS_AU * scalePxPerAU, MIN_SUN_RADIUS_PX);
        
        for (let i = 5; i >= 1; i--) {
            const glowRadius = sunVisualRadius * (1 + i * 0.8);
            const gradient = ctx.createRadialGradient(centerX, centerY, sunVisualRadius * 0.5, centerX, centerY, glowRadius);
            gradient.addColorStop(0, `rgba(255, 200, 100, ${0.15 / i})`);
            gradient.addColorStop(0.5, `rgba(255, 150, 50, ${0.1 / i})`);
            gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');
            ctx.beginPath();
            ctx.arc(centerX, centerY, glowRadius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
        }
        
        const sunGradient = ctx.createRadialGradient(
            centerX - sunVisualRadius * 0.3, centerY - sunVisualRadius * 0.3, 0,
            centerX, centerY, sunVisualRadius
        );
        sunGradient.addColorStop(0, '#FFFFFF');
        sunGradient.addColorStop(0.2, '#FFF8E0');
        sunGradient.addColorStop(0.5, '#FFE080');
        sunGradient.addColorStop(0.8, '#FFB020');
        sunGradient.addColorStop(1, '#FF8000');
        
        ctx.beginPath();
        ctx.arc(centerX, centerY, sunVisualRadius, 0, Math.PI * 2);
        ctx.fillStyle = sunGradient;
        ctx.fill();
    }
    
    function drawOrbit(sunX, sunY, planet, scalePxPerAU) {
        const { a_AU, e } = planet;
        const aPx = a_AU * scalePxPerAU;
        const bPx = aPx * Math.sqrt(1 - e * e);
        const cPx = aPx * e;
        
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(100, 120, 160, 0.35)';
        ctx.lineWidth = 1;
        ctx.ellipse(sunX - cPx, sunY, aPx, bPx, 0, 0, Math.PI * 2);
        ctx.stroke();
    }
    
    function drawPlanet(x, y, radiusPx, color, name, hasRings = false) {
        const drawRadius = Math.max(radiusPx, MIN_VISIBLE_PLANET_RADIUS_PX);
        
        if (hasRings && drawRadius > 3) {
            drawSaturnRings(x, y, drawRadius);
        }
        
        const gradient = ctx.createRadialGradient(
            x - drawRadius * 0.35, y - drawRadius * 0.35, drawRadius * 0.1,
            x, y, drawRadius
        );
        gradient.addColorStop(0, lightenColor(color, 60));
        gradient.addColorStop(0.3, lightenColor(color, 30));
        gradient.addColorStop(0.6, color);
        gradient.addColorStop(0.85, darkenColor(color, 30));
        gradient.addColorStop(1, darkenColor(color, 50));
        
        ctx.beginPath();
        ctx.arc(x, y, drawRadius, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();
        
        if (drawRadius > 4) {
            const specular = ctx.createRadialGradient(
                x - drawRadius * 0.4, y - drawRadius * 0.4, 0,
                x - drawRadius * 0.4, y - drawRadius * 0.4, drawRadius * 0.4
            );
            specular.addColorStop(0, 'rgba(255, 255, 255, 0.5)');
            specular.addColorStop(0.5, 'rgba(255, 255, 255, 0.1)');
            specular.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.beginPath();
            ctx.arc(x, y, drawRadius, 0, Math.PI * 2);
            ctx.fillStyle = specular;
            ctx.fill();
        }
        
        if (showLabels) {
            ctx.font = '12px "Segoe UI", sans-serif';
            ctx.fillStyle = 'rgba(200, 210, 230, 0.9)';
            ctx.textAlign = 'center';
            ctx.fillText(name, x, y - drawRadius - 8);
        }
    }
    
    function drawSaturnRings(x, y, planetRadius) {
        const innerRingRadius = planetRadius * 1.4;
        const outerRingRadius = planetRadius * 2.3;
        const ringColors = [
            'rgba(210, 190, 150, 0.7)',
            'rgba(180, 160, 120, 0.5)',
            'rgba(200, 180, 140, 0.6)',
            'rgba(160, 140, 100, 0.4)'
        ];
        const numRings = 4;
        const ringWidth = (outerRingRadius - innerRingRadius) / numRings;
        
        for (let i = 0; i < numRings; i++) {
            const r1 = innerRingRadius + i * ringWidth;
            const r2 = r1 + ringWidth * 0.8;
            ctx.beginPath();
            ctx.arc(x, y, r2, 0, Math.PI * 2);
            ctx.arc(x, y, r1, Math.PI * 2, 0, true);
            ctx.fillStyle = ringColors[i];
            ctx.fill();
        }
    }
    
    function lightenColor(hex, percent) {
        const num = parseInt(hex.replace('#', ''), 16);
        const amt = Math.round(2.55 * percent);
        const R = Math.min(255, (num >> 16) + amt);
        const G = Math.min(255, ((num >> 8) & 0x00FF) + amt);
        const B = Math.min(255, (num & 0x0000FF) + amt);
        return `rgb(${R}, ${G}, ${B})`;
    }
    
    function darkenColor(hex, percent) {
        const num = parseInt(hex.replace('#', ''), 16);
        const amt = Math.round(2.55 * percent);
        const R = Math.max(0, (num >> 16) - amt);
        const G = Math.max(0, ((num >> 8) & 0x00FF) - amt);
        const B = Math.max(0, (num & 0x0000FF) - amt);
        return `rgb(${R}, ${G}, ${B})`;
    }
    
    // ============================================================
    // MAIN RENDER LOOP
    // ============================================================
    
    function render(timestamp) {
        if (!lastFrameTime) lastFrameTime = timestamp;
        const dtSeconds = (timestamp - lastFrameTime) / 1000;
        lastFrameTime = timestamp;
        
        if (!isPaused) {
            simulationTimeDays += dtSeconds * timeScale;
        }
        
        const distanceScalePxPerAU = BASE_SCALE_PX_PER_AU * zoom;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        
        drawBackground();
        
        if (showOrbits) {
            for (const planet of PLANETS_DATA) {
                drawOrbit(centerX, centerY, planet, distanceScalePxPerAU);
            }
        }
        
        drawSun(centerX, centerY, distanceScalePxPerAU);
        
        for (const planet of PLANETS_DATA) {
            const pos = calculatePlanetPosition(planet, simulationTimeDays);
            const screenX = centerX + pos.x * distanceScalePxPerAU;
            const screenY = centerY - pos.y * distanceScalePxPerAU;
            const radiusAU = planet.radiusKm / AU_KM;
            const radiusPx = radiusAU * distanceScalePxPerAU;
            drawPlanet(screenX, screenY, radiusPx, planet.color, planet.name, planet.name === "Saturn");
        }
        
        requestAnimationFrame(render);
    }
    
    // ============================================================
    // SOLAR SYSTEM UI
    // ============================================================
    
    function updateUI() {
        document.getElementById('timeScaleInput').value = timeScale;
        document.getElementById('zoomInput').value = zoom.toFixed(2);
    }
    
    function setTimeScale(value) {
        const newValue = parseFloat(value);
        if (!isNaN(newValue) && newValue >= MIN_TIME_SCALE && newValue <= MAX_TIME_SCALE) {
            timeScale = Math.round(newValue);
            updateUI();
        }
    }
    
    function updateTimeStep(value) {
        const newStep = parseFloat(value);
        if (!isNaN(newStep) && newStep >= 1) {
            timeStep = newStep;
        }
    }
    
    function changeTimeScale(direction) {
        timeScale += direction * timeStep;
        timeScale = Math.max(MIN_TIME_SCALE, Math.min(MAX_TIME_SCALE, timeScale));
        timeScale = Math.round(timeScale);
        updateUI();
    }
    
    function setZoom(value) {
        const newValue = parseFloat(value);
        if (!isNaN(newValue) && newValue >= MIN_ZOOM && newValue <= MAX_ZOOM) {
            zoom = newValue;
            updateUI();
        }
    }
    
    function updateZoomStep(value) {
        const newStep = parseFloat(value);
        if (!isNaN(newStep) && newStep >= 0.1) {
            zoomStep = newStep;
        }
    }
    
    function changeZoom(direction) {
        zoom += direction * zoomStep;
        zoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, zoom));
        zoom = Math.round(zoom * 100) / 100;
        updateUI();
    }
    
    function resetView() {
        zoom = 1.0;
        updateUI();
    }
    
    function togglePause() {
        isPaused = !isPaused;
        const btn = document.getElementById('pauseBtn');
        btn.textContent = isPaused ? '‚ñ∂ Resume' : '‚è∏ Pause';
        btn.classList.toggle('paused', isPaused);
    }
    
    function toggleLabels() {
        showLabels = !showLabels;
        document.getElementById('toggleLabels').classList.toggle('active', showLabels);
    }
    
    function toggleOrbits() {
        showOrbits = !showOrbits;
        document.getElementById('toggleOrbits').classList.toggle('active', showOrbits);
    }
    
    // ============================================================
    // POMODORO AUDIO
    // ============================================================
    
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
    }
    
    function playSound(type) {
        initAudio();
        
        const now = audioContext.currentTime;
        
        if (type === 'complete') {
            // Cheerful ascending tones
            const frequencies = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            frequencies.forEach((freq, i) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = freq;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, now + i * 0.15);
                gainNode.gain.linearRampToValueAtTime(0.3, now + i * 0.15 + 0.05);
                gainNode.gain.linearRampToValueAtTime(0, now + i * 0.15 + 0.3);
                
                oscillator.start(now + i * 0.15);
                oscillator.stop(now + i * 0.15 + 0.4);
            });
        } else if (type === 'break') {
            // Gentle two-tone notification
            const frequencies = [440, 554.37]; // A4, C#5
            frequencies.forEach((freq, i) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = freq;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, now + i * 0.2);
                gainNode.gain.linearRampToValueAtTime(0.25, now + i * 0.2 + 0.05);
                gainNode.gain.linearRampToValueAtTime(0, now + i * 0.2 + 0.4);
                
                oscillator.start(now + i * 0.2);
                oscillator.stop(now + i * 0.2 + 0.5);
            });
        }
    }
    
    // ============================================================
    // POMODORO TIMER
    // ============================================================
    
    function updatePomodoroSettings() {
        pomodoroState.settings.focusTime = parseInt(document.getElementById('focusTime').value) || 25;
        pomodoroState.settings.shortBreakTime = parseInt(document.getElementById('shortBreakTime').value) || 5;
        pomodoroState.settings.longBreakTime = parseInt(document.getElementById('longBreakTime').value) || 15;
        
        if (!pomodoroState.isRunning) {
            pomodoroState.timeRemaining = pomodoroState.settings.focusTime * 60;
            pomodoroState.totalTime = pomodoroState.timeRemaining;
            updateTimerDisplay();
        }
        
        // Save settings
        localStorage.setItem('pomodoroSettings', JSON.stringify(pomodoroState.settings));
    }
    
    function loadPomodoroSettings() {
        const saved = localStorage.getItem('pomodoroSettings');
        if (saved) {
            pomodoroState.settings = JSON.parse(saved);
            document.getElementById('focusTime').value = pomodoroState.settings.focusTime;
            document.getElementById('shortBreakTime').value = pomodoroState.settings.shortBreakTime;
            document.getElementById('longBreakTime').value = pomodoroState.settings.longBreakTime;
        }
        
        // Load count (reset daily)
        const countData = localStorage.getItem('pomodoroCount');
        if (countData) {
            const { count, date } = JSON.parse(countData);
            const today = new Date().toDateString();
            if (date === today) {
                pomodoroState.completedPomodoros = count;
            }
        }
        
        pomodoroState.timeRemaining = pomodoroState.settings.focusTime * 60;
        pomodoroState.totalTime = pomodoroState.timeRemaining;
        updateTimerDisplay();
        updatePomodoroCount();
    }
    
    function savePomodoroCount() {
        const data = {
            count: pomodoroState.completedPomodoros,
            date: new Date().toDateString()
        };
        localStorage.setItem('pomodoroCount', JSON.stringify(data));
    }
    
    function updateTimerDisplay() {
        const minutes = Math.floor(pomodoroState.timeRemaining / 60);
        const seconds = pomodoroState.timeRemaining % 60;
        document.getElementById('timerDisplay').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // Update progress bar
        const progress = (pomodoroState.timeRemaining / pomodoroState.totalTime) * 100;
        const progressFill = document.getElementById('progressFill');
        progressFill.style.width = `${progress}%`;
        
        // Update status and colors
        const statusEl = document.getElementById('timerStatus');
        progressFill.classList.remove('focusing', 'resting');
        statusEl.classList.remove('focusing', 'resting');
        
        if (pomodoroState.mode === 'focus') {
            statusEl.textContent = pomodoroState.isRunning ? 'üî• Focusing...' : 'Ready to focus';
            if (pomodoroState.isRunning) {
                progressFill.classList.add('focusing');
                statusEl.classList.add('focusing');
            }
        } else {
            const breakType = pomodoroState.mode === 'longBreak' ? 'Long Break' : 'Short Break';
            statusEl.textContent = pomodoroState.isRunning ? `‚òï ${breakType}...` : `${breakType} ready`;
            if (pomodoroState.isRunning) {
                progressFill.classList.add('resting');
                statusEl.classList.add('resting');
            }
        }
    }
    
    function updatePomodoroCount() {
        document.getElementById('pomodoroCount').textContent = `√ó ${pomodoroState.completedPomodoros}`;
    }
    
    function togglePomodoro() {
        if (pomodoroState.isRunning) {
            pausePomodoro();
        } else {
            startPomodoro();
        }
    }
    
    function startPomodoro() {
        initAudio(); // Initialize audio context on user interaction
        
        pomodoroState.isRunning = true;
        document.getElementById('pomodoroStartBtn').textContent = '‚è∏ Pause';
        document.getElementById('pomodoroStartBtn').classList.add('running');
        
        pomodoroInterval = setInterval(() => {
            pomodoroState.timeRemaining--;
            updateTimerDisplay();
            
            if (pomodoroState.timeRemaining <= 0) {
                clearInterval(pomodoroInterval);
                pomodoroState.isRunning = false;
                onPomodoroComplete();
            }
        }, 1000);
    }
    
    function pausePomodoro() {
        pomodoroState.isRunning = false;
        clearInterval(pomodoroInterval);
        document.getElementById('pomodoroStartBtn').textContent = '‚ñ∂ Start';
        document.getElementById('pomodoroStartBtn').classList.remove('running');
        updateTimerDisplay();
    }
    
    function onPomodoroComplete() {
        if (pomodoroState.mode === 'focus') {
            // Completed a focus session
            pomodoroState.completedPomodoros++;
            updatePomodoroCount();
            savePomodoroCount();
            playSound('complete');
            
            // Determine break type
            const isLongBreak = pomodoroState.completedPomodoros % 4 === 0;
            showPomodoroCompleteModal(isLongBreak);
        } else {
            // Completed a break
            playSound('break');
            showBreakCompleteModal();
        }
        
        document.getElementById('pomodoroStartBtn').textContent = '‚ñ∂ Start';
        document.getElementById('pomodoroStartBtn').classList.remove('running');
    }
    
    function skipPomodoro() {
        clearInterval(pomodoroInterval);
        pomodoroState.isRunning = false;
        
        if (pomodoroState.mode === 'focus') {
            // Skip to break without counting
            startBreak(false);
        } else {
            // Skip break, go to focus
            startFocus();
        }
    }
    
    function resetPomodoro() {
        clearInterval(pomodoroInterval);
        pomodoroState.isRunning = false;
        pomodoroState.mode = 'focus';
        pomodoroState.timeRemaining = pomodoroState.settings.focusTime * 60;
        pomodoroState.totalTime = pomodoroState.timeRemaining;
        
        document.getElementById('pomodoroStartBtn').textContent = '‚ñ∂ Start';
        document.getElementById('pomodoroStartBtn').classList.remove('running');
        updateTimerDisplay();
    }
    
    function resetPomodoroCount() {
        pomodoroState.completedPomodoros = 0;
        updatePomodoroCount();
        savePomodoroCount();
    }
    
    function startFocus() {
        pomodoroState.mode = 'focus';
        pomodoroState.timeRemaining = pomodoroState.settings.focusTime * 60;
        pomodoroState.totalTime = pomodoroState.timeRemaining;
        updateTimerDisplay();
    }
    
    function startBreak(isLong) {
        pomodoroState.mode = isLong ? 'longBreak' : 'shortBreak';
        const breakTime = isLong ? pomodoroState.settings.longBreakTime : pomodoroState.settings.shortBreakTime;
        pomodoroState.timeRemaining = breakTime * 60;
        pomodoroState.totalTime = pomodoroState.timeRemaining;
        updateTimerDisplay();
        startPomodoro();
    }
    
    function extendBreak() {
        pomodoroState.timeRemaining += 5 * 60; // Add 5 minutes
        pomodoroState.totalTime = pomodoroState.timeRemaining;
        updateTimerDisplay();
        startPomodoro();
    }
    
    // ============================================================
    // MODAL
    // ============================================================
    
    function showModal(title, message, buttons) {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalMessage').textContent = message;
        
        const buttonsContainer = document.getElementById('modalButtons');
        buttonsContainer.innerHTML = '';
        
        buttons.forEach(btn => {
            const button = document.createElement('button');
            button.textContent = btn.text;
            button.className = btn.class || 'btn-primary';
            button.onclick = () => {
                hideModal();
                if (btn.action) btn.action();
            };
            buttonsContainer.appendChild(button);
        });
        
        document.getElementById('pomodoroModal').classList.add('show');
    }
    
    function hideModal() {
        document.getElementById('pomodoroModal').classList.remove('show');
    }
    
    function showPomodoroCompleteModal(isLongBreak) {
        const breakTime = isLongBreak ? pomodoroState.settings.longBreakTime : pomodoroState.settings.shortBreakTime;
        const breakType = isLongBreak ? 'Long Break' : 'Short Break';
        
        showModal(
            'üéâ Pomodoro Complete!',
            `Great job! You've completed ${pomodoroState.completedPomodoros} pomodoro${pomodoroState.completedPomodoros > 1 ? 's' : ''} today.`,
            [
                {
                    text: `‚òï Start ${breakType} (${breakTime}min)`,
                    class: 'btn-start',
                    action: () => startBreak(isLongBreak)
                },
                {
                    text: 'üî• Skip Break, Continue',
                    class: 'btn-primary',
                    action: () => { startFocus(); startPomodoro(); }
                },
                {
                    text: '‚è∏ Pause',
                    class: 'btn-secondary',
                    action: () => startFocus()
                }
            ]
        );
    }
    
    function showBreakCompleteModal() {
        showModal(
            '‚òï Break Complete!',
            'Ready to get back to work?',
            [
                {
                    text: 'üî• Start Next Pomodoro',
                    class: 'btn-start',
                    action: () => { startFocus(); startPomodoro(); }
                },
                {
                    text: '‚òï +5 More Minutes',
                    class: 'btn-secondary',
                    action: () => extendBreak()
                },
                {
                    text: '‚è∏ Pause',
                    class: 'btn-secondary',
                    action: () => startFocus()
                }
            ]
        );
    }
    
    // ============================================================
    // INITIALIZATION
    // ============================================================
    
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    
    function init() {
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        generateStars();
        
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            changeZoom(e.deltaY > 0 ? -1 : 1);
        }, { passive: false });
        
        // Load saved settings
        loadPanelPositions();
        loadPomodoroSettings();
        
        updateUI();
        requestAnimationFrame(render);
    }
    
    window.addEventListener('load', init);
    </script>
</body>
</html>
